#--
# SPDX-FileCopyrightText: 2026 Kerrick Long <me@kerricklong.com>
# SPDX-License-Identifier: LGPL-3.0-or-later
#++

module RatatuiRuby
  module Tea
    module Command
      # Sentinel value for application termination.
      class Exit < Data
        def self.new: () -> instance
      end

      # Command to run a shell command via Open3.
      class System < Data
        attr_reader command: String
        attr_reader tag: Symbol | Class
        attr_reader stream: bool

        # Returns true if streaming mode is enabled.
        def stream?: () -> bool

        def self.new: (command: String, tag: (Symbol | Class), stream: bool) -> instance
      end

      # Command that wraps another command's result with a transformation.
      class Mapped < Data
        attr_reader inner_command: execution
        attr_reader mapper: ^(untyped) -> untyped

        def self.new: (inner_command: execution, mapper: ^(untyped) -> untyped) -> instance
      end

      # Union type for all valid commands
      type execution = Execute | Mapped

      # Creates a quit command.
      def self.exit: () -> Quit

      # Creates a shell execution command.
      def self.system: (String command, (Symbol | Class) tag, ?stream: bool) -> System

      # Creates a mapped command for Fractal Architecture composition.
      def self.map: (execution inner_command) { (untyped) -> untyped } -> Mapped
    end
  end
end
